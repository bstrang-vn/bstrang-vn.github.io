(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-89c166de"],{4873:function(e,t,r){"use strict";r.d(t,"e",(function(){return b})),r.d(t,"h",(function(){return v})),r.d(t,"c",(function(){return O})),r.d(t,"d",(function(){return m})),r.d(t,"a",(function(){return j})),r.d(t,"f",(function(){return h})),r.d(t,"g",(function(){return g})),r.d(t,"i",(function(){return w})),r.d(t,"b",(function(){return x}));var n=r("3835"),a=r("1da1"),c=r("5530"),i=(r("96cf"),r("159b"),r("c740"),r("a434"),r("d81d"),r("d3b7"),r("3ca3"),r("ddb0"),r("4fad"),r("b64b"),r("99af"),r("e71f")),o=r("7a23"),u=r("bcc2"),s=(new Date).getFullYear(),d=(new Date).getMonth()+1,p=new Date(s+"-"+d).getTime(),b=Object(o["M"])([]),l=Object(i["j"])(),f=Object(i["n"])(Object(i["d"])(l,"IMPORTNOTE"),Object(i["r"])("updatedAt",">",p),Object(i["m"])("updatedAt","asc"));Object(i["l"])(f,(function(e){e.docChanges().forEach((function(e){var t=Object(c["a"])(Object(c["a"])({},e.doc.data()),{},{importNoteID:e.doc.id}),r=b.findIndex((function(t){return t.importNoteID===e.doc.id}));"added"===e.type?b.unshift(t):"modified"===e.type?b.splice(r,1,t):"removed"===e.type&&b.splice(r,1)}))}));var v=function(e){var t=Object(o["N"])({}),r=Object(i["l"])(Object(i["g"])(l,"IMPORTNOTE",e),function(){var r=Object(a["a"])(regeneratorRuntime.mark((function r(n){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n.exists()){r.next=2;break}return r.abrupt("return");case 2:t.value=Object(c["a"])(Object(c["a"])({},n.data()),{},{importNoteID:e});case 3:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}());return{data:t,unSubscribe:r}},O=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("ID must not be empty");case 2:return r=Object(i["g"])(l,"IMPORTNOTE",t),e.next=5,Object(i["h"])(r);case 5:if(n=e.sent,n.exists()){e.next=8;break}throw new Error("ImportNote not found !!!");case 8:return e.abrupt("return",Object(c["a"])(Object(c["a"])({},n.data()),{},{importNoteID:n.id}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.map((function(e){return Object(i["h"])(Object(i["g"])(l,"IMPORTNOTE",e))})),e.next=3,Promise.all(r);case 3:return n=e.sent,e.abrupt("return",n.map((function(e){return Object(c["a"])(Object(c["a"])({},e.data()),{},{importNoteID:e.id})})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=Object(u["a"])(new Date,"YY-MM-DD-HH-mm-ss"),n=Object(i["g"])(l,"IMPORTNOTE",r),e.next=4,Object(i["h"])(n);case 4:if(a=e.sent,!a.exists()){e.next=7;break}throw new Error("Phiếu nhập này đã tồn tại");case 7:return e.next=9,Object(i["p"])(n,Object(c["a"])(Object(c["a"])({},t),{},{status:"Pending",createdAt:(new Date).getTime(),updatedAt:(new Date).getTime(),removedAt:0}));case 9:return e.abrupt("return",n.id);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(i["o"])(l,function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(r){var a,o,u,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=Object(i["g"])(l,"IMPORTNOTE",t),e.next=3,r.get(a);case 3:if(o=e.sent,o.exists()){e.next=6;break}throw new Error("Document not exists");case 6:if(u=o.data(),s=Object.assign({},u),"Pending"===s.status){e.next=9;break}throw new Error("Notes is not in pending status");case 9:Object.entries(s.stockIn).forEach((function(e){var t=Object(n["a"])(e,2),o=t[0],u=t[1],s={};Object.entries(u).forEach((function(e){var t=Object(n["a"])(e,2),r=t[0],a=t[1].quantity,c="stockAvail."+r+".quantity";s[c]=Object(i["k"])(a)})),r.update(Object(i["g"])(l,"WAREHOUSE",o),Object(c["a"])(Object(c["a"])({},s),{},{importNoteIDList:Object(i["c"])(a.id)}))})),r.update(Object(i["g"])(l,"PROVIDER",s.provider.providerID),{importNoteIDList:Object(i["c"])(t)}),r.update(a,{status:"Success"});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(i["o"])(l,function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(r){var a,c,o,u,s,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=Object(i["g"])(l,"IMPORTNOTE",t),e.next=3,r.get(a);case 3:if(c=e.sent,c.exists()){e.next=6;break}throw new Error("Document not exists");case 6:if(o=c.data(),u=Object.assign({},o),"Success"===u.status){e.next=9;break}throw new Error("Notes is not in success status");case 9:return s=Object.keys(u.stockIn).map((function(e){return r.get(Object(i["g"])(l,"WAREHOUSE",e))})),e.next=12,Promise.all(s);case 12:d=e.sent,d.forEach((function(e){var a=e.data()||{},c=a.stockAvail,o=a.goodsName;Object.entries(u.stockIn[e.id]).forEach((function(e){var t=Object(n["a"])(e,2),r=t[0],a=t[1].quantity;if(!c[r])throw new Error("".concat(o," with ").concat(r," are not available in warehouse"));if(c[r].quantity<a)throw new Error("".concat(o," available is ").concat(c[r].quantity,". But, you have just export ").concat(a));c[r].quantity!==a?c[r].quantity-=a:delete c[r]})),r.update(Object(i["g"])(l,"WAREHOUSE",e.id),{stockAvail:c,importNoteIDList:Object(i["b"])(t)})})),r.update(Object(i["g"])(l,"PROVIDER",u.provider.providerID),{importNoteIDList:Object(i["b"])(t)}),r.update(a,{status:"Pending"});case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,r){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("ID must not be empty");case 2:return n=Object(i["g"])(l,"IMPORTNOTE",t),e.next=5,Object(i["h"])(n);case 5:if(a=e.sent,a.exists()){e.next=8;break}throw new Error("ImportNote not found !!!");case 8:if("Pending"===a.data().status){e.next=10;break}throw new Error("Notes is not in pending status");case 10:return e.next=12,Object(i["q"])(n,Object(c["a"])(Object(c["a"])({},r),{},{updatedAt:(new Date).getTime()}));case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),x=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(i["e"])(Object(i["g"])(l,"IMPORTNOTE",t));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},"54f9":function(e,t,r){"use strict";r("a430")},"7d34":function(e,t,r){"use strict";r.r(t);var n=r("7a23"),a=Object(n["m"])("h1",{class:"title-content"},"Thông tin nhà cung cấp",-1),c={class:"flex"},i=Object(n["m"])("div",{class:"w-10"},"Tên",-1),o=Object(n["m"])("div",{class:"w-3"},":",-1),u={class:"flex"},s=Object(n["m"])("div",{class:"w-10"},"SĐT",-1),d=Object(n["m"])("div",{class:"w-3"},":",-1),p={class:"flex"},b=Object(n["m"])("div",{class:"w-10"},"Đ/c",-1),l=Object(n["m"])("div",{class:"w-3"},":",-1),f=Object(n["n"])(" Edit "),v=Object(n["m"])("div",{class:"mt-4 mb-1 font-bold"},"Danh sách phiếu nhập hàng",-1),O={class:"wrapper-table"},m={class:"table"},j=Object(n["m"])("thead",null,[Object(n["m"])("th",null,"#"),Object(n["m"])("th",null,"Ngày"),Object(n["m"])("th",null,"Tổng tiền")],-1),h={key:0},g=Object(n["m"])("td",{class:"text-center",colspan:"7"},"No data available in table",-1),w=[g],x=["onClick"],D={class:"text-center"},R={class:"text-right"},k={class:"text-right font-bold"},I={class:"flex justify-between mt-4"},N=Object(n["n"])("Back"),y=Object(n["n"])(" Delete ");function P(e,t,r,g,P,E){var M,T=Object(n["R"])("a-button"),A=Object(n["R"])("ModalProviderCreateModify");return Object(n["I"])(),Object(n["l"])(n["b"],null,[a,Object(n["m"])("div",null,[Object(n["m"])("div",c,[i,o,Object(n["m"])("div",null,Object(n["V"])(g.provider.providerName),1)]),Object(n["m"])("div",u,[s,d,Object(n["m"])("div",null,Object(n["V"])(g.provider.phone),1)]),Object(n["m"])("div",p,[b,l,Object(n["m"])("div",null,Object(n["V"])(g.provider.address),1)]),Object(n["m"])("div",null,[Object(n["o"])(T,{onClick:t[0]||(t[0]=function(t){return e.$refs.modalProviderCreateModify.openModal(g.provider.providerID)})},{default:Object(n["cb"])((function(){return[f]})),_:1}),Object(n["o"])(A,{ref:"modalProviderCreateModify"},null,512)])]),v,Object(n["m"])("div",O,[Object(n["m"])("table",m,[j,Object(n["m"])("tbody",null,[0===g.importNoteList.length?(Object(n["I"])(),Object(n["l"])("tr",h,w)):Object(n["k"])("",!0),(Object(n["I"])(!0),Object(n["l"])(n["b"],null,Object(n["P"])(g.importNoteList,(function(t,r){return Object(n["I"])(),Object(n["l"])("tr",{key:r,onClick:function(r){return e.$router.push({name:"ImportNote Details",params:{id:t.noteID}})}},[Object(n["m"])("td",D,Object(n["V"])(r+1),1),Object(n["m"])("td",R,Object(n["V"])(E.formatDateTime(t.createdAt)),1),Object(n["m"])("td",k,Object(n["V"])(t.finance.totalMoney),1)],8,x)})),128))])])]),Object(n["m"])("div",I,[Object(n["o"])(T,{onClick:t[1]||(t[1]=function(t){return e.$router.go(-1)})},{default:Object(n["cb"])((function(){return[N]})),_:1}),0===(null===(M=g.provider.importNoteIDList)||void 0===M?void 0:M.length)?(Object(n["I"])(),Object(n["j"])(T,{key:0,onClick:E.confirmDeleteProvider,loading:g.loadingDeleteProvider,type:"dashed"},{default:Object(n["cb"])((function(){return[y]})),_:1},8,["onClick","loading"])):Object(n["k"])("",!0)])],64)}var E=r("1da1"),M=(r("d3b7"),r("25f0"),r("96cf"),r("6c02")),T=r("f64c"),A=r("ed3b"),L=r("96d9"),C=r("7db8"),V=r("4873"),S=r("a08a"),q=r("bcc2"),U={components:{ModalProviderCreateModify:S["a"]},setup:function(){var e=Object(M["c"])(),t=Object(C["e"])(e.params.id);return{provider:t.data,realtimeProvider:t,importNoteList:Object(n["N"])([]),loadingDeleteProvider:Object(n["N"])(!1)}},unmounted:function(){this.realtimeProvider.unSubscribe()},watch:{"provider.importNoteIDList":{handler:function(e,t){var r=this;return Object(E["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(V["d"])(e);case 2:r.importNoteList=t.sent.reverse();case 3:case"end":return t.stop()}}),t)})))()},deep:!0}},methods:{startDeleteProvider:function(){var e=this;return Object(E["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loadingDeleteProvider=!0,t.prev=1,e.realtimeProvider.unSubscribe(),t.next=5,Object(C["b"])(e.provider.providerID);case 5:e.$router.push({name:"Provider List",params:{}}),T["a"].success("Delete provider success !!!",2),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),console.error(t.t0),T["a"].error(t.t0.toString(),10);case 13:return t.prev=13,e.loadingDeleteProvider=!1,t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[1,9,13,16]])})))()},confirmDeleteProvider:function(){if(this.provider.importNoteIDList.length>0)this.$notification.open({message:"Lỗi !!!",description:"Phiếu nhập hàng của nhà cung cấp này vẫn tồn tại. Không thể xóa nhà cung cấp này",placement:"topRight",duration:5});else{var e=this;A["a"].confirm({title:"Confirm",icon:Object(n["o"])(L["a"]),content:"Bạn có chắc chắn muốn xóa nhà cung cấp này ?",onOk:function(){e.startDeleteProvider()}})}},formatDateTime:function(e){return Object(q["a"])(e,"DD/MM/YY")}}},$=r("6b0d"),_=r.n($);const H=_()(U,[["render",P]]);t["default"]=H},"7db8":function(e,t,r){"use strict";r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return d})),r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return f})),r.d(t,"f",(function(){return l})),r.d(t,"c",(function(){return p}));var n=r("1da1"),a=r("5530"),c=(r("96cf"),r("159b"),r("c740"),r("a434"),r("e71f")),i=r("7a23"),o=Object(i["M"])([]),u=Object(c["j"])(),s=Object(c["n"])(Object(c["d"])(u,"PROVIDER"));Object(c["l"])(s,(function(e){e.docChanges().forEach((function(e){var t=Object(a["a"])({providerID:e.doc.id},e.doc.data()),r=o.findIndex((function(t){return t.providerID===e.doc.id}));"added"===e.type?o.push(t):"modified"===e.type?o.splice(r,1,t):"removed"===e.type&&o.splice(r,1)}))}));var d=function(e){var t=Object(i["N"])({}),r=Object(c["l"])(Object(c["g"])(u,"PROVIDER",e),function(){var r=Object(n["a"])(regeneratorRuntime.mark((function r(n){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n.exists()){r.next=2;break}return r.abrupt("return");case 2:t.value=Object(a["a"])({providerID:e},n.data());case 3:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}());return{data:t,unSubscribe:r}},p=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var r,n,a,i,o,s,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=Object(c["g"])(u,"PROVIDER",t),e.next=3,Object(c["h"])(r);case 3:if(n=e.sent,n.exists()){e.next=6;break}return e.abrupt("return",{});case 6:return a=n.data(),i=a.providerName,o=a.phone,s=a.address,d=a.importNoteIDList,e.abrupt("return",{providerID:t,providerName:i,phone:o,address:s,importNoteIDList:d});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["a"])(Object(c["d"])(u,"PROVIDER"),{providerName:t.providerName,phone:t.phone,address:t.address,importNoteIDList:[],createdAt:(new Date).getTime(),updatedAt:(new Date).getTime(),removedAt:0});case 2:return r=e.sent,e.next=5,p(r.id);case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=Object(c["g"])(u,"PROVIDER",t),e.next=3,Object(c["q"])(n,{providerName:r.providerName,phone:r.phone,address:r.address,updatedAt:(new Date).getTime()});case 3:return e.next=5,p(n.id);case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),f=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["e"])(Object(c["g"])(u,"PROVIDER",t));case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},a08a:function(e,t,r){"use strict";var n=r("7a23"),a=function(e){return Object(n["L"])("data-v-62472f8a"),e=e(),Object(n["J"])(),e},c={class:"flex items-center mb-2"},i=a((function(){return Object(n["m"])("div",{class:"w-100px flex-none"},"Name",-1)})),o={class:"flex items-center mb-2"},u=a((function(){return Object(n["m"])("div",{class:"w-100px flex-none"},"Phone",-1)})),s={class:"flex items-center mb-2"},d=a((function(){return Object(n["m"])("div",{class:"w-100px flex-none"},"Address",-1)}));function p(e,t,r,a,p,b){var l=Object(n["R"])("a-input"),f=Object(n["R"])("a-modal");return Object(n["I"])(),Object(n["j"])(f,{visible:a.visibleModal,"onUpdate:visible":t[3]||(t[3]=function(e){return a.visibleModal=e}),width:"900px",title:a.provider.providerID?"Update Provider":"Create New Provider","confirm-loading":a.confirmModalLoading,afterClose:b.refreshModal,onOk:b.handleActionProviderOk},{default:Object(n["cb"])((function(){return[Object(n["m"])("form",null,[Object(n["m"])("div",c,[i,Object(n["o"])(l,{value:a.provider.providerName,"onUpdate:value":t[0]||(t[0]=function(e){return a.provider.providerName=e}),class:"flex-auto"},null,8,["value"])]),Object(n["m"])("div",o,[u,Object(n["o"])(l,{value:a.provider.phone,"onUpdate:value":t[1]||(t[1]=function(e){return a.provider.phone=e}),class:"flex-auto"},null,8,["value"])]),Object(n["m"])("div",s,[d,Object(n["o"])(l,{value:a.provider.address,"onUpdate:value":t[2]||(t[2]=function(e){return a.provider.address=e}),class:"flex-auto"},null,8,["value"])])])]})),_:1},8,["visible","title","confirm-loading","afterClose","onOk"])}var b=r("1da1"),l=(r("96cf"),r("7db8")),f={setup:function(){return{visibleModal:Object(n["N"])(!1),confirmModalLoading:Object(n["N"])(!1),provider:Object(n["N"])({providerID:"",providerName:"",phone:"",address:""})}},methods:{openModal:function(e){var t=this;return Object(b["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.visibleModal=!0,!e){r.next=9;break}return r.next=4,Object(l["c"])(e);case 4:n=r.sent,t.provider.providerID=n.providerID,t.provider.providerName=n.providerName,t.provider.phone=n.phone,t.provider.address=n.address;case 9:case"end":return r.stop()}}),r)})))()},refreshModal:function(){this.provider.providerID="",this.provider.providerName="",this.provider.phone="",this.provider.address="",this.confirmModalLoading=!1},handleActionProviderOk:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var r,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.confirmModalLoading=!0,r={providerName:e.provider.providerName,phone:e.provider.phone,address:e.provider.address},t.prev=2,e.provider.providerID){t.next=10;break}return t.next=6,Object(l["a"])(r);case 6:n=t.sent,e.$emit("actionProvider",n),t.next=14;break;case 10:return t.next=12,Object(l["f"])(e.provider.providerID,r);case 12:a=t.sent,e.$emit("actionProvider",a);case 14:e.visibleModal=!1,t.next=20;break;case 17:t.prev=17,t.t0=t["catch"](2),console.log(t.t0);case 20:case"end":return t.stop()}}),t,null,[[2,17]])})))()}}},v=(r("54f9"),r("6b0d")),O=r.n(v);const m=O()(f,[["render",p],["__scopeId","data-v-62472f8a"]]);t["a"]=m},a430:function(e,t,r){},d81d:function(e,t,r){"use strict";var n=r("23e7"),a=r("b727").map,c=r("1dde"),i=c("map");n({target:"Array",proto:!0,forced:!i},{map:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=chunk-89c166de.e49b7929.js.map